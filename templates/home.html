{% extends "base.html" %}

{% block title %} Home Page {% endblock title %}

{% block bodyclass %} bg-gray-200
{% endblock bodyclass%}
{% block pbody %}
{% if messages %}
  {% for message in messages %}
    <div class="mb-3 text-sm text-center px-3 py-2 rounded-md bg-red-100 text-red-700">
      {{ message }}
    </div>
  {% endfor %}
{% endif %}

  <main class="max-w-7xl mx-auto px-4 py-8">
    <div class="grid grid-cols-1 lg:grid-cols-3 gap-6">
      
      <!-- Left column: Forms -->
      <section class="lg:col-span-1 space-y-6">

        <!-- Add Income -->
        <div class="bg-white rounded-xl shadow p-5">
          <h3 class="text-lg font-semibold text-[var(--primary)] mb-3">Add Income</h3>
          <form method="post">
            {% csrf_token %}
            <div class="space-y-3">
              <div>
                    <input type="text" name="source" placeholder="Source (Salary, Freelance)" class="w-full border p-2 mb-3 rounded">
                    <input type="number" step="0.01" name="amount" placeholder="Amount" class="w-full border p-2 mb-3 rounded">
                    <input type="date" name="date" class="w-full border p-2 mb-3 rounded">
                    <button type="submit" name="add_income" class="w-full text-red bg-green-700 py-2 rounded hover:opacity-90 text-white hover:bg-green-600">Add Income</button>
              </div>
            </div>
          </form>
        </div>

        <!-- Add Category -->
        <div class="bg-white rounded-xl shadow p-5">
          <h3 class="text-lg font-semibold text-[var(--primary)] mb-3">Add Category</h3>
          
          <form method="post">
            {% csrf_token %}
            <div class="flex gap-2">
                <input type="text" name="category_name" placeholder="New Category" class="flex-1 border p-2 rounded-sm">
               <button type="submit" name="add_category"class="text-white bg-[#1f3a43] px-5 py-2 rounded-md hover:bg-gray-400 transition">
              Add</button>
            </div>
          </form>
        </div>

        <!-- Add Expense -->
        <div class="bg-white rounded-xl shadow p-5">
            <h3 class="text-lg font-semibold text-[var(--primary)] mb-3 ">Add Expense</h3>
        <form method="post">
            {% csrf_token %}
            <div class="space-y-3">
              <div>
                <select name="category" class="w-full border p-2 mb-3 rounded" required>
                    <option hidden >Select Category</option>
                    {%for cat in categorydata %}
                        <option value="{{cat.id}}">{{cat.name}}</option>
                    {% endfor %}
                </select>
                <input type="number" step="0.01" name="amount" placeholder="Amount" class="w-full border p-2 mb-3 rounded" required>
                <input type="date" name="date" class="w-full border p-2 mb-3 rounded" required>
                <button type="submit" name="add_expense" class="w-full bg-red-600 text-white py-2 rounded hover:opacity-90 hover:bg-red-500">Add Expense</button>
              </div>
            </div>
        </form>
        </div>
      </section>

      
      <!-- Middle column: Summary -->
      <section class="lg:col-span-2 grid grid-cols-1 md:grid-cols-2 gap-6">

        <!-- Summary boxes -->
        <div class="bg-white rounded-xl shadow p-5">
          <div class="flex items-center justify-between">
            <div>
              <h4 class="text-sm text-gray-500"><strong>Total Income</strong></h4>
              <div class="text-2xl font-bold text-green-600">₹ {{ total_income }}</div>
            </div>
            <div class="text-xs text-gray-400">Updated</div>
          </div>
        </div>

        <div class="bg-white rounded-xl shadow p-5">
          <div class="flex items-center justify-between">
            <div>
              <h4 class="text-sm text-gray-500"><strong>Total Expense</strong></h4>
              <div class="text-2xl font-bold text-red-600">₹ {{ total_expense }}</div>
            </div>
            <div class="text-xs text-gray-400">Updated</div>
          </div>
        </div>

        <div class="bg-white rounded-xl shadow p-5 md:col-span-2">
          <div class="flex items-center justify-between mb-3">
            <div>
              <h4 class="text-sm text-gray-500"><strong> Current Balance</strong></h4>
              <div class="text-3xl font-extrabold 
              {% if current_balance > 200 %} text-green-600 
              {% elif current_balance <= 200 and current_balance > 0  %}text-yellow-500 
              {% else %}text-red-600 {% endif %}">
                ₹ {{ current_balance }}</div>
            </div>
            <div class="text-right text-sm text-gray-400">
              <div>Total Income: ₹ {{ total_income }}</div>
              <div>Total Expense: ₹ {{ total_expense }}</div>
            </div>
          </div>

          <!-- Recent transactions table -->
          <div class="overflow-x-auto">
            <table class="min-w-full divide-y divide-gray-200">
              <thead class="bg-gray-50">
                <tr>
                  <th class="px-4 py-2 text-left text-xs text-gray-500">Type</th>
                  <th class="px-4 py-2 text-left text-xs text-gray-500">Category/Source</th>
                  <th class="px-4 py-2 text-left text-xs text-gray-500">Amount</th>
                  <th class="px-4 py-2 text-left text-xs text-gray-500">Date</th>
                </tr>
              </thead>
              <tbody class="bg-white divide-y divide-gray-100">
                {% for tra in recent_transcation %}
                <tr>
                  <td class="px-4 py-3 text-sm text-green-700 font-medium">{{tra.type}}</td>
                  {% if tra.source == "" %}
                    <td class="px-4 py-3 text-sm">{{ tra.category }}</td>
                  {% else %}
                    <td class="px-4 py-3 text-sm">{{ tra.source }}</td>
                  {% endif %}
                  <td class="px-4 py-3 text-sm">₹ {{ tra.amount }}</td>
                  <td class="px-4 py-3 text-sm">{{ tra.date }}</td>
                </tr>
                {% endfor %}

                {% if recent_transcation|length == 0  %}
                <tr>
                  <td colspan="4" class="px-4 py-6 text-center text-gray-400">No transactions yet — add income or expense.</td>
                </tr>
                {% endif %}
              </tbody>
            </table>
          </div>
        </div>

      </section>
    </div>
  </main>

  <script>
    // mobile menu toggle (keeps header simple)
    const mmBtn = document.getElementById('mobileMenuBtn');
    mmBtn?.addEventListener('click', () => {
      alert('Add mobile menu or navigation here as needed.');
    });
  </script>


{% endblock pbody %}